# 派单算法设计文档

> 公平、透明、可解释

## 核心原则

1. **骑手优先** - 考虑骑手当前负载、距离、疲劳度
2. **效率兼顾** - 减少配送时间，提升整体效率
3. **透明可解释** - 每一单为什么派给这个骑手，都有据可查
4. **防止剥削** - 设置单量上限，防止骑手过度劳动

## 算法流程

```
1. 订单创建
   ↓
2. 筛选可用骑手（5公里内、未超时工作）
   ↓
3. 计算综合得分
   - 距离得分（40%）：骑手到商家的距离
   - 负载得分（30%）：骑手当前待配送单量
   - 效率得分（20%）：骑手历史准时率
   - 公平得分（10%）：考虑骑手今日单量均衡
   ↓
4. 排序选择Top 3
   ↓
5. 考虑特殊情况
   - 高峰期加权
   - 特殊天气调整
   - 商家出餐速度
   ↓
6. 最终派单
```

## 评分公式

```
Score = w1 × distance_score + w2 × load_score + w3 × efficiency_score + w4 × fairness_score

其中：
- distance_score = 1 - (实际距离 / 最大考虑距离)
- load_score = 1 - (当前单量 / 单量上限)
- efficiency_score = 历史准时率
- fairness_score = 1 - (今日单量 / 骑手平均单量)
```

## 防止剥削机制

- 单量上限：每名骑手每小时最多 4 单
- 强制休息：连续工作 2 小时后强制休息 15 分钟
- 距离保护：单程超过 5 公里的订单加价 30%

## 争议解决

如果骑手对派单有异议，可通过 App 申诉，系统将记录：
- 派单时所有骑手的得分
- 申诉处理时间承诺：24 小时内回复

## 算法透明

所有派单记录将保存在区块链上，任何人可以查询：
- 某订单为什么派给某骑手
- 某骑手的派单历史
- 整体派单数据统计

---

*算法版本：v1.0.0*
*最后更新：2025-01-31*
